<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="918 Technologies BlockChain BailBonds - Oklahoma Bail Bond Contract Generator">
  <title>Oklahoma Bail Bond Contract Generator - 918 Technologies</title>
  <!-- PWA requirements -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#1e40af">
  <link rel="apple-touch-icon" href="./icons/icon-192x192.svg">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    /* Base styles */
    :root {
      --primary: #1e40af;  /* Deep blue */
      --primary-hover: #1e3a8a;
      --accent: #f97316;   /* Orange for emphasis */
      --accent-hover: #ea580c;
      --destructive: #dc2626;  /* Red for warnings */
      --success: #16a34a;  /* Green for success */
      --background: #f8fafc;
      --foreground: #0f172a;
      --card: #ffffff;
      --card-foreground: #0f172a;
      --border: #e2e8f0;
      --muted: #f1f5f9;
      --muted-foreground: #64748b;
      --radius: 0.5rem;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: var(--background);
      color: var(--foreground);
      line-height: 1.5;
    }

    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* Typography */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.2;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    h2 {
      font-size: 2rem;
      margin-bottom: 0.75rem;
    }

    h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    p {
      margin-bottom: 1rem;
    }

    .text-center {
      text-align: center;
    }

    .text-sm {
      font-size: 0.875rem;
    }

    .text-xs {
      font-size: 0.75rem;
    }

    .text-lg {
      font-size: 1.125rem;
    }

    .text-xl {
      font-size: 1.25rem;
    }

    .text-2xl {
      font-size: 1.5rem;
    }

    .text-3xl {
      font-size: 1.875rem;
    }

    .text-primary {
      color: var(--primary);
    }

    .text-destructive {
      color: var(--destructive);
    }

    .text-success {
      color: var(--success);
    }

    .text-muted {
      color: var(--muted-foreground);
    }

    .font-bold {
      font-weight: 700;
    }

    .font-medium {
      font-weight: 500;
    }

    /* Layout */
    .flex {
      display: flex;
    }

    .flex-col {
      flex-direction: column;
    }

    .items-center {
      align-items: center;
    }

    .items-start {
      align-items: flex-start;
    }

    .justify-center {
      justify-content: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .gap-1 {
      gap: 0.25rem;
    }

    .gap-2 {
      gap: 0.5rem;
    }

    .gap-3 {
      gap: 0.75rem;
    }

    .gap-4 {
      gap: 1rem;
    }

    .gap-6 {
      gap: 1.5rem;
    }

    .mx-auto {
      margin-left: auto;
      margin-right: auto;
    }

    .mb-1 {
      margin-bottom: 0.25rem;
    }

    .mb-2 {
      margin-bottom: 0.5rem;
    }

    .mb-4 {
      margin-bottom: 1rem;
    }

    .mb-6 {
      margin-bottom: 1.5rem;
    }

    .mb-8 {
      margin-bottom: 2rem;
    }

    .mb-12 {
      margin-bottom: 3rem;
    }

    .mr-2 {
      margin-right: 0.5rem;
    }

    .ml-2 {
      margin-left: 0.5rem;
    }

    .mt-2 {
      margin-top: 0.5rem;
    }

    .mt-4 {
      margin-top: 1rem;
    }

    .grid {
      display: grid;
    }

    .grid-cols-1 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }

    .p-4 {
      padding: 1rem;
    }

    .p-6 {
      padding: 1.5rem;
    }

    .py-2 {
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }

    .py-3 {
      padding-top: 0.75rem;
      padding-bottom: 0.75rem;
    }

    .py-4 {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    .px-4 {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .px-6 {
      padding-left: 1.5rem;
      padding-right: 1.5rem;
    }

    /* Components */
    .hidden {
      display: none !important;
    }

    .card {
      background-color: var(--card);
      border-radius: var(--radius);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      border-radius: var(--radius);
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      background-color: var(--primary-hover);
    }

    .btn-accent {
      background-color: var(--accent);
      color: white;
    }

    .btn-accent:hover:not(:disabled) {
      background-color: var(--accent-hover);
    }

    .btn-destructive {
      background-color: var(--destructive);
      color: white;
    }

    .btn-success {
      background-color: var(--success);
      color: white;
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--border);
      color: var(--foreground);
    }

    .btn-outline:hover {
      background-color: var(--muted);
    }

    .border-t {
      border-top: 1px solid var(--border);
    }

    .border-b {
      border-bottom: 1px solid var(--border);
    }

    .rounded {
      border-radius: var(--radius);
    }

    .w-full {
      width: 100%;
    }

    input, select, textarea {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 1rem;
      font-size: 0.875rem;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary);
    }

    label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    /* Toast */
    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      padding: 1rem;
      background-color: white;
      border-radius: var(--radius);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      max-width: 350px;
      animation: slideInRight 0.3s, fadeOut 0.3s 2.7s;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      from {
        opacity: 1;
      }
      to {
        opacity: 0;
      }
    }

    /* Contract styles */
    .contract-document {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 3rem;
      border: 1px solid #ddd;
      position: relative;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      font-family: "Times New Roman", Times, serif;
      line-height: 1.6;
    }

    .contract-watermark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-45deg);
      font-size: 4rem;
      color: rgba(0, 0, 0, 0.05);
      white-space: nowrap;
      pointer-events: none;
    }

    .contract-content {
      position: relative;
      z-index: 1;
    }

    .contract-content h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      font-weight: bold;
    }

    .contract-content h3 {
      font-weight: bold;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .bond-number {
      text-align: right;
      margin-bottom: 1rem;
    }

    .contract-footer {
      margin-top: 3rem;
      text-align: center;
      font-size: 0.8rem;
      color: #666;
    }

    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }

    .tab {
      padding: 0.75rem 1.5rem;
      cursor: pointer;
      font-weight: 500;
      border-bottom: 2px solid transparent;
    }

    .tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Progress Steps */
    .steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      position: relative;
    }

    .steps::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 40px;
      right: 40px;
      height: 2px;
      background: var(--border);
      z-index: 0;
    }

    .step-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .step-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--muted);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.5rem;
      color: var(--muted-foreground);
      border: 2px solid var(--muted);
    }

    .step-label {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--muted-foreground);
      text-align: center;
      max-width: 100px;
    }

    .step-item.active .step-icon {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .step-item.active .step-label {
      color: var(--primary);
    }

    .step-item.completed .step-icon {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    .step-item.completed .step-label {
      color: var(--success);
    }

    /* Signature pad */
    .signature-pad-container {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 1rem;
      position: relative;
    }

    #signature-pad {
      width: 100%;
      height: 200px;
      background-color: white;
    }

    .signature-controls {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    /* Domain badges */
    .domain-badges {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }

    .domain-badge {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      flex: 1;
      padding: 0.5rem;
    }

    .domain-icon {
      width: 3rem;
      height: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 9999px;
      margin-bottom: 0.5rem;
      font-size: 1.5rem;
    }

    .blockchain-badge .domain-icon {
      background-color: rgba(37, 99, 235, 0.1);
      color: #2563eb;
    }

    .crypto-badge .domain-icon {
      background-color: rgba(245, 158, 11, 0.1);
      color: #f59e0b;
    }

    .nft-badge .domain-icon {
      background-color: rgba(139, 92, 246, 0.1);
      color: #8b5cf6;
    }

    .domain-badge h4 {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .domain-badge p {
      font-size: 0.75rem;
      color: var(--muted-foreground);
    }

    /* Console output for blockchain transactions */
    .blockchain-console {
      background-color: #1e1e1e;
      padding: 1rem;
      border-radius: var(--radius);
      font-family: monospace;
      color: #e0e0e0;
      height: 200px;
      overflow-y: auto;
      margin-top: 1rem;
    }

    .console-line {
      margin-bottom: 0.5rem;
      line-height: 1.4;
    }

    .success {
      color: #4ade80;
    }

    .error {
      color: #f87171;
    }

    .warning {
      color: #fbbf24;
    }

    .info {
      color: #60a5fa;
    }

    /* Animation */
    .slide-in {
      animation: slideIn 0.5s ease-out forwards;
    }

    @keyframes slideIn {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loading indicator */
    .loading-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (min-width: 768px) {
      .grid-cols-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      
      .grid-cols-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
      
      .grid-cols-5 {
        grid-template-columns: repeat(5, minmax(0, 1fr));
      }

      .form-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }
  </style>
</head>
<body>
  <div id="toast-container"></div>

  <!-- Header -->
  <header class="bg-white border-b py-4 mb-6">
    <div class="container flex justify-between items-center">
      <div class="flex items-center gap-2">
        <div class="text-primary text-3xl">
          <i class="fas fa-link-slash"></i>
        </div>
        <div>
          <h2 class="text-primary mb-0">918 Technologies</h2>
          <p class="text-xs text-muted">BlockChain BailBonds</p>
        </div>
      </div>
      <div>
        <nav>
          <ul class="flex gap-4">
            <li><a href="index.html" class="text-primary">Home</a></li>
            <li><a href="bondsman-portal.html" class="text-primary">Bondsman Portal</a></li>
            <li><a href="domain-structure.html" class="text-primary">Domain Architecture</a></li>
            <li><a href="domain-wizard.html" class="text-primary">Connection Wizard</a></li>
            <li><a href="#" class="text-primary font-medium">Contract Generator</a></li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container pb-12">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold mb-2">Oklahoma Bail Bond Contract Generator</h1>
      <p class="text-muted">Generate legally compliant bail bond contracts secured on the blockchain</p>
    </div>

    <!-- Domain Badges -->
    <div class="domain-badges mb-8">
      <div class="domain-badge blockchain-badge">
        <div class="domain-icon">
          <i class="fas fa-cube"></i>
        </div>
        <h4>Nine1Eight.blockchain</h4>
        <p>Contract Generation</p>
      </div>
      <div class="domain-badge crypto-badge">
        <div class="domain-icon">
          <i class="fas fa-coins"></i>
        </div>
        <h4>Nine1Eight.crypto</h4>
        <p>Payment Processing</p>
      </div>
      <div class="domain-badge nft-badge">
        <div class="domain-icon">
          <i class="fas fa-image"></i>
        </div>
        <h4>Nine1Eight.nft</h4>
        <p>Contract Verification</p>
      </div>
    </div>

    <!-- Progress Steps -->
    <div class="steps mb-8">
      <div class="step-item active" id="step-1">
        <div class="step-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="step-label">Contract Information</div>
      </div>
      <div class="step-item" id="step-2">
        <div class="step-icon">
          <i class="fas fa-pen-fancy"></i>
        </div>
        <div class="step-label">Review & Sign</div>
      </div>
      <div class="step-item" id="step-3">
        <div class="step-icon">
          <i class="fas fa-cube"></i>
        </div>
        <div class="step-label">Blockchain Deployment</div>
      </div>
      <div class="step-item" id="step-4">
        <div class="step-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="step-label">Verification</div>
      </div>
    </div>

    <!-- Step 1: Contract Information -->
    <div id="contract-info-step" class="step-content active">
      <div class="card">
        <h2 class="text-xl font-bold mb-4">Bond Contract Information</h2>
        <p class="mb-4">Enter the necessary information to generate a legally compliant Oklahoma bail bond contract.</p>
        
        <div class="tabs mb-6">
          <div class="tab active" data-tab="standard">Standard Bond</div>
          <div class="tab" data-tab="property">Property Bond</div>
          <div class="tab" data-tab="cash">Cash Bond</div>
        </div>
        
        <form id="contract-form">
          <input type="hidden" id="bond-type" name="bondType" value="standard">
          
          <!-- Standard Bond Form -->
          <div id="standard-tab" class="tab-content active">
            <h3 class="font-medium mb-4">Standard Bail Bond Details</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="bond-amount">Bail Amount ($)</label>
                <input type="number" id="bond-amount" name="bondAmount" required>
              </div>
              
              <div class="form-group">
                <label for="charge-description">Charge Description</label>
                <select id="charge-description" name="chargeDescription" required>
                  <option value="" disabled selected>Select a charge</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>
              
              <div class="form-group">
                <label for="court-name">Court Name</label>
                <select id="court-name" name="courtName" required>
                  <option value="" disabled selected>Select a court</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>
              
              <div class="form-group">
                <label for="county-name">County</label>
                <select id="county-name" name="countyName" required>
                  <option value="" disabled selected>Select a county</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>
            </div>
            
            <h3 class="font-medium mb-4 mt-6">Defendant Information</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="defendant-name">Full Legal Name</label>
                <input type="text" id="defendant-name" name="defendantName" required>
              </div>
              
              <div class="form-group">
                <label for="defendant-dob">Date of Birth</label>
                <input type="date" id="defendant-dob" name="defendantDOB" required>
              </div>
              
              <div class="form-group">
                <label for="defendant-address">Address</label>
                <input type="text" id="defendant-address" name="defendantAddress" required>
              </div>
              
              <div class="form-group">
                <label for="defendant-phone">Phone Number</label>
                <input type="tel" id="defendant-phone" name="defendantPhone" required>
              </div>
              
              <div class="form-group">
                <label for="booking-number">Booking Number</label>
                <input type="text" id="booking-number" name="bookingNumber" required>
              </div>
              
              <div class="form-group">
                <label for="case-number">Case Number</label>
                <input type="text" id="case-number" name="caseNumber" required>
              </div>
            </div>
            
            <h3 class="font-medium mb-4 mt-6">Indemnitor Information</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="indemnitor-name">Full Legal Name</label>
                <input type="text" id="indemnitor-name" name="indemnitorName" required>
              </div>
              
              <div class="form-group">
                <label for="indemnitor-relationship">Relationship to Defendant</label>
                <input type="text" id="indemnitor-relationship" name="indemnitorRelationship" required>
              </div>
              
              <div class="form-group">
                <label for="indemnitor-address">Address</label>
                <input type="text" id="indemnitor-address" name="indemnitorAddress" required>
              </div>
              
              <div class="form-group">
                <label for="indemnitor-phone">Phone Number</label>
                <input type="tel" id="indemnitor-phone" name="indemnitorPhone" required>
              </div>
            </div>
            
            <h3 class="font-medium mb-4 mt-6">Bondsman Information</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="bondsman-name">Bondsman Name</label>
                <input type="text" id="bondsman-name" name="bondsmanName" required>
              </div>
              
              <div class="form-group">
                <label for="bondsman-license">Bondsman License Number</label>
                <input type="text" id="bondsman-license" name="bondsmanLicense" required>
              </div>
            </div>
          </div>
          
          <!-- Property Bond Form (Initially Hidden) -->
          <div id="property-tab" class="tab-content">
            <h3 class="font-medium mb-4">Property Bond Details</h3>
            
            <!-- Standard fields first -->
            <div class="form-grid">
              <div class="form-group">
                <label for="property-bond-amount">Bail Amount ($)</label>
                <input type="number" id="property-bond-amount" name="bondAmount">
              </div>
              
              <div class="form-group">
                <label for="property-charge-description">Charge Description</label>
                <select id="property-charge-description" name="chargeDescription">
                  <option value="" disabled selected>Select a charge</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>
            </div>
            
            <!-- Property-specific fields -->
            <h3 class="font-medium mb-4 mt-6">Property Information</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="property-address">Property Address</label>
                <input type="text" id="property-address" name="propertyAddress">
              </div>
              
              <div class="form-group">
                <label for="property-value">Assessed Value ($)</label>
                <input type="number" id="property-value" name="propertyValue">
              </div>
              
              <div class="form-group">
                <label for="property-owners">Property Owner(s)</label>
                <input type="text" id="property-owners" name="propertyOwners">
              </div>
              
              <div class="form-group">
                <label for="recording-county">Recording County</label>
                <select id="recording-county" name="recordingCounty">
                  <option value="" disabled selected>Select a county</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>
              
              <div class="form-group">
                <label for="recording-number">Recording Number</label>
                <input type="text" id="recording-number" name="recordingNumber">
              </div>
              
              <div class="form-group">
                <label for="property-legal-description">Legal Description</label>
                <textarea id="property-legal-description" name="propertyLegalDescription" rows="4"></textarea>
              </div>
            </div>
            
            <!-- Add defendant and indemnitor fields similar to the standard form -->
          </div>
          
          <!-- Cash Bond Form (Initially Hidden) -->
          <div id="cash-tab" class="tab-content">
            <h3 class="font-medium mb-4">Cash Bond Details</h3>
            
            <!-- Standard fields first -->
            <div class="form-grid">
              <div class="form-group">
                <label for="cash-bond-amount">Bail Amount ($)</label>
                <input type="number" id="cash-bond-amount" name="bondAmount">
              </div>
              
              <div class="form-group">
                <label for="cash-charge-description">Charge Description</label>
                <select id="cash-charge-description" name="chargeDescription">
                  <option value="" disabled selected>Select a charge</option>
                  <!-- Options will be populated by JavaScript -->
                </select>
              </div>
            </div>
            
            <!-- Cash-specific fields -->
            <h3 class="font-medium mb-4 mt-6">Cash Collateral Information</h3>
            
            <div class="form-grid">
              <div class="form-group">
                <label for="cash-collateral-amount">Cash Collateral Amount ($)</label>
                <input type="number" id="cash-collateral-amount" name="cashCollateralAmount">
              </div>
              
              <div class="form-group">
                <label for="payment-method">Payment Method</label>
                <select id="payment-method" name="paymentMethod">
                  <option value="" disabled selected>Select payment method</option>
                  <option value="Cash">Cash</option>
                  <option value="Bitcoin">Bitcoin</option>
                  <option value="Ethereum">Ethereum</option>
                  <option value="USDC">USDC</option>
                  <option value="USDT">USDT</option>
                </select>
              </div>
              
              <div class="form-group crypto-payment-field hidden">
                <label for="crypto-payment-details">Crypto Payment Details</label>
                <input type="text" id="crypto-payment-details" name="cryptoPaymentDetails" placeholder="Wallet address, transaction details, etc.">
              </div>
              
              <div class="form-group crypto-payment-field hidden">
                <label for="payment-transaction-hash">Transaction Hash</label>
                <input type="text" id="payment-transaction-hash" name="paymentTransactionHash" placeholder="0x...">
              </div>
            </div>
            
            <!-- Add defendant and indemnitor fields similar to the standard form -->
          </div>
          
          <div class="mt-8">
            <button type="submit" class="btn btn-primary w-full">
              Generate Contract
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Step 2: Review & Sign -->
    <div id="review-sign-step" class="step-content hidden">
      <div class="card">
        <h2 class="text-xl font-bold mb-4">Review & Sign Contract</h2>
        <p class="mb-4">Review the contract details and sign using the signature pad below.</p>
        
        <div id="contract-preview" class="mb-6">
          <!-- Contract HTML will be generated here -->
          <div class="loading-indicator">
            <div class="loading-spinner"></div>
          </div>
        </div>
        
        <h3 class="font-medium mb-2">Signatures Required</h3>
        
        <div class="mb-6">
          <div class="form-group mb-4">
            <label for="signature-type">Select signature to provide:</label>
            <select id="signature-type" class="mb-2">
              <option value="defendant">Defendant Signature</option>
              <option value="indemnitor">Indemnitor Signature</option>
              <option value="bondsman">Bondsman Signature</option>
            </select>
            
            <div class="signature-pad-container">
              <canvas id="signature-pad"></canvas>
            </div>
            
            <div class="signature-controls">
              <button type="button" id="clear-signature" class="btn btn-outline">
                <i class="fas fa-eraser mr-2"></i>Clear
              </button>
              <button type="button" id="save-signature" class="btn btn-primary">
                <i class="fas fa-save mr-2"></i>Save Signature
              </button>
            </div>
          </div>
          
          <div class="signature-status grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-3 rounded bg-gray-100">
              <div class="flex items-center mb-2">
                <div id="defendant-status-icon" class="mr-2 text-muted">
                  <i class="far fa-circle"></i>
                </div>
                <span class="font-medium">Defendant</span>
              </div>
              <div id="defendant-signature-status" class="text-sm text-muted">
                Signature required
              </div>
            </div>
            
            <div class="p-3 rounded bg-gray-100">
              <div class="flex items-center mb-2">
                <div id="indemnitor-status-icon" class="mr-2 text-muted">
                  <i class="far fa-circle"></i>
                </div>
                <span class="font-medium">Indemnitor</span>
              </div>
              <div id="indemnitor-signature-status" class="text-sm text-muted">
                Signature required
              </div>
            </div>
            
            <div class="p-3 rounded bg-gray-100">
              <div class="flex items-center mb-2">
                <div id="bondsman-status-icon" class="mr-2 text-muted">
                  <i class="far fa-circle"></i>
                </div>
                <span class="font-medium">Bondsman</span>
              </div>
              <div id="bondsman-signature-status" class="text-sm text-muted">
                Signature required
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex justify-between">
          <button type="button" id="back-to-info" class="btn btn-outline">
            <i class="fas fa-arrow-left mr-2"></i>Back
          </button>
          <button type="button" id="finalize-contract" class="btn btn-primary" disabled>
            Finalize Contract
          </button>
        </div>
      </div>
    </div>

    <!-- Step 3: Blockchain Deployment -->
    <div id="blockchain-step" class="step-content hidden">
      <div class="card">
        <h2 class="text-xl font-bold mb-4">Blockchain Deployment</h2>
        <p class="mb-4">Deploying your contract to the blockchain across multiple Nine1Eight domains.</p>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <div class="text-center p-4">
            <div class="domain-icon blockchain-badge mx-auto">
              <i class="fas fa-cube"></i>
            </div>
            <h4 class="font-medium mb-1">Nine1Eight.blockchain</h4>
            <p class="text-sm mb-2">Smart Contract Deployment</p>
            <div id="blockchain-status" class="py-1 px-2 rounded-full bg-muted inline-block text-xs">
              <i class="fas fa-circle-notch fa-spin mr-1"></i>
              <span>Waiting</span>
            </div>
          </div>
          
          <div class="text-center p-4">
            <div class="domain-icon crypto-badge mx-auto">
              <i class="fas fa-coins"></i>
            </div>
            <h4 class="font-medium mb-1">Nine1Eight.crypto</h4>
            <p class="text-sm mb-2">Payment & Escrow</p>
            <div id="crypto-status" class="py-1 px-2 rounded-full bg-muted inline-block text-xs">
              <i class="fas fa-circle-notch fa-spin mr-1"></i>
              <span>Waiting</span>
            </div>
          </div>
          
          <div class="text-center p-4">
            <div class="domain-icon nft-badge mx-auto">
              <i class="fas fa-image"></i>
            </div>
            <h4 class="font-medium mb-1">Nine1Eight.nft</h4>
            <p class="text-sm mb-2">NFT Contract Generation</p>
            <div id="nft-status" class="py-1 px-2 rounded-full bg-muted inline-block text-xs">
              <i class="fas fa-circle-notch fa-spin mr-1"></i>
              <span>Waiting</span>
            </div>
          </div>
        </div>
        
        <div class="mb-6">
          <h3 class="font-medium mb-2">Deployment Progress</h3>
          <div class="w-full bg-muted rounded-full h-2.5 mb-1">
            <div class="bg-primary h-2.5 rounded-full" id="deploy-progress-bar" style="width: 0%"></div>
          </div>
          <div class="flex justify-between text-xs">
            <span id="deploy-status">Preparing deployment...</span>
            <span id="deploy-percentage">0%</span>
          </div>
        </div>
        
        <div class="blockchain-console">
          <div class="console-line info">Preparing contract data for blockchain deployment...</div>
        </div>
      </div>
    </div>

    <!-- Step 4: Verification -->
    <div id="verify-step" class="step-content hidden">
      <div class="card">
        <div class="text-center mb-6">
          <div class="text-5xl text-success mb-3">
            <i class="fas fa-check-circle"></i>
          </div>
          <h2 class="text-2xl font-bold mb-2">Contract Successfully Deployed!</h2>
          <p class="mb-4">Your Oklahoma bail bond contract has been successfully deployed to the blockchain.</p>
        </div>
        
        <div class="bg-gray-100 p-4 rounded mb-6">
          <h3 class="font-medium mb-2">Contract Information</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <p><strong>Contract ID:</strong> <span id="contract-id"></span></p>
              <p><strong>Date Created:</strong> <span id="contract-date"></span></p>
              <p><strong>Bond Amount:</strong> <span id="contract-amount"></span></p>
            </div>
            <div>
              <p><strong>Defendant:</strong> <span id="contract-defendant"></span></p>
              <p><strong>Bondsman:</strong> <span id="contract-bondsman"></span></p>
              <p><strong>Court Date:</strong> <span id="contract-court-date"></span></p>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
          <div>
            <h3 class="font-medium mb-2">Blockchain Verification</h3>
            <div class="bg-gray-100 p-4 rounded text-sm">
              <p class="mb-2"><strong>Transaction ID:</strong></p>
              <p class="mb-3"><code id="contract-tx-id" class="text-xs p-1 bg-white rounded"></code></p>
              
              <p class="mb-2"><strong>Contract Hash:</strong></p>
              <p class="mb-3"><code id="contract-hash" class="text-xs p-1 bg-white rounded"></code></p>
              
              <p class="mb-2"><strong>Block Number:</strong> <span id="contract-block"></span></p>
              <p class="mb-2"><strong>Confirmations:</strong> <span id="contract-confirmations"></span></p>
            </div>
          </div>
          
          <div>
            <h3 class="font-medium mb-2">NFT Verification</h3>
            <div class="bg-gray-100 p-4 rounded text-sm">
              <p class="mb-2"><strong>NFT Token ID:</strong> <span id="nft-token-id"></span></p>
              <p class="mb-2"><strong>Contract Address:</strong></p>
              <p class="mb-3"><code id="nft-contract-address" class="text-xs p-1 bg-white rounded"></code></p>
              
              <div class="flex justify-between items-center">
                <p><strong>Verification Link:</strong></p>
                <a href="#" id="nft-verification-link" target="_blank" class="btn btn-primary btn-sm">
                  <i class="fas fa-external-link-alt mr-1"></i>View
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <div class="flex justify-between">
          <a href="bail-contract-generator.html" class="btn btn-outline">
            <i class="fas fa-plus-circle mr-2"></i>Create New Contract
          </a>
          <button type="button" id="download-contract" class="btn btn-primary">
            <i class="fas fa-download mr-2"></i>Download Contract
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="py-4 mt-8 border-t text-sm text-muted bg-white">
    <div class="container">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
          &copy; <span id="current-year"></span> 918 Technologies Inc. All rights reserved.
        </div>
        <div class="flex gap-4">
          <a href="#" class="text-primary">Terms</a>
          <a href="#" class="text-primary">Privacy</a>
          <a href="#" class="text-primary">Support</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- JavaScript for SignaturePad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
  
  <!-- Contract Generator Script -->
  <script src="./contract-generator.js"></script>
  
  <!-- Domain Connector Script -->
  <script src="./domain-connector.js"></script>
  
  <!-- Translations Script -->
  <script src="./translations.js"></script>
  
  <!-- Bondsman Actions Script -->
  <script src="./bondsman-actions.js"></script>
  
  <!-- Main Application Script -->
  <script>
    // Set current year in footer
    document.getElementById('current-year').textContent = new Date().getFullYear();
    
    // DOM Elements
    const contractForm = document.getElementById('contract-form');
    const bondTypeInput = document.getElementById('bond-type');
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const signatureTypeSelect = document.getElementById('signature-type');
    const clearSignatureBtn = document.getElementById('clear-signature');
    const saveSignatureBtn = document.getElementById('save-signature');
    const backToInfoBtn = document.getElementById('back-to-info');
    const finalizeContractBtn = document.getElementById('finalize-contract');
    
    // Step navigation
    const steps = document.querySelectorAll('.step-item');
    const stepContents = document.querySelectorAll('.step-content');
    
    // Current step and contract data
    let currentStep = 1;
    let contractObject = null;
    let signatures = {
      defendant: null,
      indemnitor: null,
      bondsman: null
    };
    
    // Initialize SignaturePad
    const canvas = document.getElementById('signature-pad');
    const signaturePad = new SignaturePad(canvas, {
      backgroundColor: 'rgb(255, 255, 255)'
    });
    
    // Show toast notification
    function showToast(title, message, variant = "default") {
      const toastContainer = document.getElementById('toast-container');
      
      const toast = document.createElement('div');
      toast.className = 'toast';
      
      if (variant === "destructive") {
        toast.style.borderLeft = "4px solid var(--destructive)";
      } else if (variant === "success") {
        toast.style.borderLeft = "4px solid var(--success)";
      } else {
        toast.style.borderLeft = "4px solid var(--primary)";
      }
      
      toast.innerHTML = `
        <div class="font-semibold">${title}</div>
        <div class="text-sm text-muted">${message}</div>
      `;
      
      toastContainer.appendChild(toast);
      
      // Remove toast after 3 seconds
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
    
    // Add log to blockchain console
    function addConsoleLog(message, type = 'info') {
      const consoleElement = document.querySelector('.blockchain-console');
      const logLine = document.createElement('div');
      logLine.className = `console-line ${type}`;
      logLine.textContent = message;
      
      consoleElement.appendChild(logLine);
      consoleElement.scrollTop = consoleElement.scrollHeight;
    }
    
    // Populate form dropdowns with Oklahoma data
    function populateFormDropdowns() {
      // Populate charges dropdown
      const chargeSelects = [
        document.getElementById('charge-description'),
        document.getElementById('property-charge-description'),
        document.getElementById('cash-charge-description')
      ];
      
      chargeSelects.forEach(select => {
        if (!select) return;
        
        // Clear existing options
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        // Add offense options
        window.OklahomaBailBondContract.commonOffenses.forEach(offense => {
          const option = document.createElement('option');
          option.value = offense.name;
          option.textContent = `${offense.name} (${offense.category})`;
          select.appendChild(option);
        });
      });
      
      // Populate courts dropdown
      const courtSelects = [
        document.getElementById('court-name')
      ];
      
      courtSelects.forEach(select => {
        if (!select) return;
        
        // Clear existing options
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        // Add court options
        window.OklahomaBailBondContract.courts.forEach(court => {
          const option = document.createElement('option');
          option.value = court.name;
          option.textContent = court.name;
          select.appendChild(option);
        });
      });
      
      // Populate counties dropdown
      const countySelects = [
        document.getElementById('county-name'),
        document.getElementById('recording-county')
      ];
      
      countySelects.forEach(select => {
        if (!select) return;
        
        // Clear existing options
        while (select.options.length > 1) {
          select.remove(1);
        }
        
        // Add county options
        window.OklahomaBailBondContract.counties.forEach(county => {
          const option = document.createElement('option');
          option.value = county.name;
          option.textContent = county.name + " County";
          select.appendChild(option);
        });
      });
    }
    
    // Handle tab switching
    function switchTab(tabName) {
      // Update active tab
      tabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.tab === tabName) {
          tab.classList.add('active');
        }
      });
      
      // Update tab content
      tabContents.forEach(content => {
        content.classList.remove('active');
        if (content.id === `${tabName}-tab`) {
          content.classList.add('active');
        }
      });
      
      // Update hidden bond type field
      bondTypeInput.value = tabName;
    }
    
    // Switch to step
    function goToStep(stepNumber) {
      // Hide all steps
      stepContents.forEach(content => {
        content.classList.add('hidden');
      });
      
      // Show current step
      document.getElementById(`step-${stepNumber}`).classList.add('active');
      if (stepNumber > 1) {
        for (let i = 1; i < stepNumber; i++) {
          document.getElementById(`step-${i}`).classList.add('completed');
          document.getElementById(`step-${i}`).classList.remove('active');
        }
      }
      stepContents[stepNumber-1].classList.remove('hidden');
      
      currentStep = stepNumber;
    }
    
    // Get form data as object
    function getFormData(form) {
      const formData = new FormData(form);
      const data = {};
      
      for (const [key, value] of formData.entries()) {
        data[key] = value;
      }
      
      return data;
    }
    
    // Generate contract
    function generateContract() {
      const formData = getFormData(contractForm);
      
      try {
        // Generate the contract using the Oklahoma contract generator
        contractObject = window.OklahomaBailBondContract.generateContract(formData);
        
        // Generate HTML representation for display
        const contractHTML = window.OklahomaBailBondContract.generateContractHTML(contractObject);
        
        // Display in preview
        document.getElementById('contract-preview').innerHTML = contractHTML;
        
        // Go to next step
        goToStep(2);
        
        showToast('Contract Generated', 'Your bail bond contract has been generated. Please review and sign.', 'success');
      } catch (error) {
        console.error('Error generating contract:', error);
        showToast('Error', 'Failed to generate contract. Please check your information.', 'destructive');
      }
    }
    
    // Handle signature saving
    function saveSignature() {
      if (signaturePad.isEmpty()) {
        showToast('Signature Required', 'Please provide a signature before saving.', 'destructive');
        return;
      }
      
      // Get signature type
      const signatureType = signatureTypeSelect.value;
      
      // Get signature data
      const signatureData = signaturePad.toDataURL();
      
      // Store signature
      signatures[signatureType] = signatureData;
      
      // Update contract with signature
      if (signatureType === 'defendant') {
        contractObject = window.OklahomaBailBondContract.signContractByDefendant(contractObject, signatureData);
        document.getElementById('defendant-status-icon').innerHTML = '<i class="fas fa-check-circle text-success"></i>';
        document.getElementById('defendant-signature-status').textContent = 'Signed';
        document.getElementById('defendant-signature-status').className = 'text-sm text-success';
      } else if (signatureType === 'indemnitor') {
        contractObject = window.OklahomaBailBondContract.signContractByIndemnitor(contractObject, signatureData);
        document.getElementById('indemnitor-status-icon').innerHTML = '<i class="fas fa-check-circle text-success"></i>';
        document.getElementById('indemnitor-signature-status').textContent = 'Signed';
        document.getElementById('indemnitor-signature-status').className = 'text-sm text-success';
      } else if (signatureType === 'bondsman') {
        contractObject = window.OklahomaBailBondContract.signContractByBondsman(contractObject, signatureData);
        document.getElementById('bondsman-status-icon').innerHTML = '<i class="fas fa-check-circle text-success"></i>';
        document.getElementById('bondsman-signature-status').textContent = 'Signed';
        document.getElementById('bondsman-signature-status').className = 'text-sm text-success';
      }
      
      // Update contract preview
      const contractHTML = window.OklahomaBailBondContract.generateContractHTML(contractObject);
      document.getElementById('contract-preview').innerHTML = contractHTML;
      
      // Clear signature pad
      signaturePad.clear();
      
      // Check if all signatures are present
      if (signatures.defendant && signatures.indemnitor && signatures.bondsman) {
        finalizeContractBtn.disabled = false;
      }
      
      showToast('Signature Saved', `The ${signatureType} signature has been saved successfully.`, 'success');
    }
    
    // Finalize and deploy contract
    async function finalizeAndDeployContract() {
      try {
        // Go to blockchain deployment step
        goToStep(3);
        
        // Finalize the contract
        addConsoleLog('Finalizing contract with all signatures...');
        updateDeploymentProgress(10, 'Finalizing contract...');
        
        // Allow UI to update
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        contractObject = window.OklahomaBailBondContract.finalizeContract(contractObject);
        addConsoleLog('Contract finalized successfully', 'success');
        updateDeploymentProgress(20, 'Contract finalized');
        
        // Update blockchain status
        document.getElementById('blockchain-status').innerHTML = `
          <i class="fas fa-circle-notch fa-spin mr-1"></i>
          <span>Deploying</span>
        `;
        document.getElementById('blockchain-status').className = 'py-1 px-2 rounded-full bg-primary/10 text-primary inline-block text-xs';
        
        // Deploy to blockchain
        addConsoleLog('Deploying contract to Nine1Eight.blockchain...');
        updateDeploymentProgress(30, 'Deploying to blockchain...');
        
        // Simulate blockchain delay
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Deploy contract
        const deployedContract = await window.OklahomaBailBondContract.deployContractToBlockchain(contractObject);
        contractObject = deployedContract;
        
        // Update blockchain status
        document.getElementById('blockchain-status').innerHTML = `
          <i class="fas fa-check-circle mr-1"></i>
          <span>Deployed</span>
        `;
        document.getElementById('blockchain-status').className = 'py-1 px-2 rounded-full bg-success/10 text-success inline-block text-xs';
        
        addConsoleLog(`Contract successfully deployed with transaction ID: ${deployedContract.transactionId}`, 'success');
        updateDeploymentProgress(50, 'Contract deployed to blockchain');
        
        // Update crypto status
        document.getElementById('crypto-status').innerHTML = `
          <i class="fas fa-circle-notch fa-spin mr-1"></i>
          <span>Processing</span>
        `;
        document.getElementById('crypto-status').className = 'py-1 px-2 rounded-full bg-primary/10 text-primary inline-block text-xs';
        
        // Process payment on Nine1Eight.crypto
        addConsoleLog('Processing premium payment through Nine1Eight.crypto...');
        updateDeploymentProgress(60, 'Processing payment...');
        
        // Simulate payment processing delay
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Update crypto status
        document.getElementById('crypto-status').innerHTML = `
          <i class="fas fa-check-circle mr-1"></i>
          <span>Confirmed</span>
        `;
        document.getElementById('crypto-status').className = 'py-1 px-2 rounded-full bg-success/10 text-success inline-block text-xs';
        
        addConsoleLog(`Premium payment of $${contractObject.contractData.premiumAmount} processed successfully`, 'success');
        updateDeploymentProgress(70, 'Payment confirmed');
        
        // Update NFT status
        document.getElementById('nft-status').innerHTML = `
          <i class="fas fa-circle-notch fa-spin mr-1"></i>
          <span>Minting</span>
        `;
        document.getElementById('nft-status').className = 'py-1 px-2 rounded-full bg-primary/10 text-primary inline-block text-xs';
        
        // Create NFT on Nine1Eight.nft
        addConsoleLog('Generating NFT certificate on Nine1Eight.nft...');
        updateDeploymentProgress(80, 'Generating NFT certificate...');
        
        // Simulate NFT creation delay
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Create NFT
        const contractWithNFT = await window.OklahomaBailBondContract.createContractNFT(contractObject);
        contractObject = contractWithNFT;
        
        // Update NFT status
        document.getElementById('nft-status').innerHTML = `
          <i class="fas fa-check-circle mr-1"></i>
          <span>Minted</span>
        `;
        document.getElementById('nft-status').className = 'py-1 px-2 rounded-full bg-success/10 text-success inline-block text-xs';
        
        addConsoleLog(`NFT created with token ID: ${contractObject.nft.tokenId}`, 'success');
        updateDeploymentProgress(90, 'NFT certificate created');
        
        // Complete deployment
        addConsoleLog('Verifying all domain connections and contract integrity...', 'info');
        updateDeploymentProgress(95, 'Verifying contract integrity...');
        
        // Final verification delay
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        addConsoleLog('Contract deployment complete across all domains!', 'success');
        updateDeploymentProgress(100, 'Deployment complete!');
        
        // Prepare verification data
        document.getElementById('contract-id').textContent = contractObject.contractId;
        document.getElementById('contract-date').textContent = contractObject.contractData.contractDate;
        document.getElementById('contract-amount').textContent = `$${parseInt(contractObject.contractData.bondAmount).toLocaleString()}`;
        document.getElementById('contract-defendant').textContent = contractObject.contractData.defendantName;
        document.getElementById('contract-bondsman').textContent = contractObject.contractData.bondsmanName;
        document.getElementById('contract-court-date').textContent = contractObject.contractData.courtDate;
        document.getElementById('contract-tx-id').textContent = contractObject.transactionId;
        document.getElementById('contract-hash').textContent = contractObject.contractHash;
        document.getElementById('contract-block').textContent = contractObject.blockNumber;
        document.getElementById('contract-confirmations').textContent = contractObject.blockchainConfirmations;
        document.getElementById('nft-token-id').textContent = contractObject.nft.tokenId;
        document.getElementById('nft-contract-address').textContent = contractObject.nft.contractAddress;
        document.getElementById('nft-verification-link').href = contractObject.nft.tokenURI;
        
        // Go to verification step
        setTimeout(() => {
          goToStep(4);
        }, 1000);
        
      } catch (error) {
        console.error('Error deploying contract:', error);
        addConsoleLog(`Error deploying contract: ${error.message}`, 'error');
        showToast('Deployment Error', 'Failed to deploy the contract. Please try again.', 'destructive');
      }
    }
    
    // Update deployment progress
    function updateDeploymentProgress(percentage, statusText) {
      document.getElementById('deploy-progress-bar').style.width = `${percentage}%`;
      document.getElementById('deploy-percentage').textContent = `${percentage}%`;
      document.getElementById('deploy-status').textContent = statusText;
    }
    
    // Resize canvas to fill container
    function resizeCanvas() {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      canvas.width = canvas.offsetWidth * ratio;
      canvas.height = canvas.offsetHeight * ratio;
      canvas.getContext("2d").scale(ratio, ratio);
      signaturePad.clear(); // otherwise isEmpty() might return incorrect value
    }
    
    // Download contract as PDF (in a real app, this would generate a PDF)
    function downloadContract() {
      // This is a simplified version - in a real app, you'd generate a PDF
      const a = document.createElement('a');
      const blob = new Blob([contractObject.contractText], {type: 'text/plain'});
      const url = URL.createObjectURL(blob);
      a.href = url;
      a.download = `Oklahoma_Bail_Bond_${contractObject.contractId}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('Contract Downloaded', 'Your contract has been downloaded successfully.', 'success');
    }
    
    // Event Listeners
    window.addEventListener('resize', resizeCanvas);
    
    // Tab switching
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        switchTab(tab.dataset.tab);
      });
    });
    
    // Contract form submission
    contractForm.addEventListener('submit', (e) => {
      e.preventDefault();
      generateContract();
    });
    
    // Signature pad controls
    clearSignatureBtn.addEventListener('click', () => {
      signaturePad.clear();
    });
    
    saveSignatureBtn.addEventListener('click', saveSignature);
    
    // Step navigation
    backToInfoBtn.addEventListener('click', () => {
      goToStep(1);
    });
    
    finalizeContractBtn.addEventListener('click', finalizeAndDeployContract);
    
    // Download contract
    document.getElementById('download-contract').addEventListener('click', downloadContract);
    
    // Payment method change event
    const paymentMethodSelect = document.getElementById('payment-method');
    if (paymentMethodSelect) {
      paymentMethodSelect.addEventListener('change', (e) => {
        const cryptoFields = document.querySelectorAll('.crypto-payment-field');
        if (e.target.value === 'Bitcoin' || e.target.value === 'Ethereum' || e.target.value === 'USDC' || e.target.value === 'USDT') {
          cryptoFields.forEach(field => field.classList.remove('hidden'));
        } else {
          cryptoFields.forEach(field => field.classList.add('hidden'));
        }
      });
    }
    
    /**
     * Change the contract language for all text elements
     * @param {string} language The language code to change to
     */
    function changeContractLanguage(language) {
      if (typeof ContractTranslations === 'undefined') return;
      
      // Update button texts
      document.querySelectorAll('.tab').forEach(tab => {
        if (tab.dataset.tab === 'standard') {
          tab.textContent = ContractTranslations.getTranslation('ui.standard_bond', {}, language);
        } else if (tab.dataset.tab === 'property') {
          tab.textContent = ContractTranslations.getTranslation('ui.property_bond', {}, language);
        } else if (tab.dataset.tab === 'cash') {
          tab.textContent = ContractTranslations.getTranslation('ui.cash_bond', {}, language);
        }
      });
      
      // Update form labels
      document.querySelectorAll('label').forEach(label => {
        const forAttr = label.getAttribute('for');
        if (!forAttr) return;
        
        // Map form field IDs to translation keys
        const labelKeys = {
          'bond-amount': 'ui.bail_amount',
          'charge-description': 'ui.charge_description',
          'court-name': 'ui.court_name',
          'county-name': 'ui.county_name',
          'defendant-name': 'ui.full_name',
          'defendant-dob': 'ui.birth_date',
          'defendant-address': 'ui.address',
          'defendant-phone': 'ui.phone',
          'booking-number': 'ui.booking_number',
          'case-number': 'ui.case_number',
          'indemnitor-name': 'ui.full_name',
          'indemnitor-relationship': 'ui.relationship',
          'indemnitor-address': 'ui.address',
          'indemnitor-phone': 'ui.phone',
          'bondsman-name': 'ui.bondsman_name',
          'bondsman-license': 'ui.bondsman_license',
          'property-address': 'ui.property_address',
          'property-value': 'ui.assessed_value',
          'property-owners': 'ui.property_owners',
          'recording-county': 'ui.recording_county',
          'recording-number': 'ui.recording_number',
          'property-legal-description': 'ui.legal_description',
          'cash-collateral-amount': 'ui.cash_collateral_amount',
          'payment-method': 'ui.payment_method',
          'crypto-payment-details': 'ui.crypto_payment_details',
          'payment-transaction-hash': 'ui.payment_transaction_hash'
        };
        
        if (labelKeys[forAttr]) {
          label.textContent = ContractTranslations.getTranslation(labelKeys[forAttr], {}, language);
        }
      });
      
      // Update headings
      document.querySelectorAll('.font-medium').forEach(heading => {
        if (heading.textContent.includes('Standard Bail Bond Details')) {
          heading.textContent = ContractTranslations.getTranslation('ui.standard_bond_details', {}, language);
        } else if (heading.textContent.includes('Property Bond Details')) {
          heading.textContent = ContractTranslations.getTranslation('ui.property_bond_details', {}, language);
        } else if (heading.textContent.includes('Cash Bond Details')) {
          heading.textContent = ContractTranslations.getTranslation('ui.cash_bond_details', {}, language);
        } else if (heading.textContent.includes('Defendant Information')) {
          heading.textContent = ContractTranslations.getTranslation('ui.defendant_info', {}, language);
        } else if (heading.textContent.includes('Indemnitor Information')) {
          heading.textContent = ContractTranslations.getTranslation('ui.indemnitor_info', {}, language);
        } else if (heading.textContent.includes('Bondsman Information')) {
          heading.textContent = ContractTranslations.getTranslation('ui.bondsman_info', {}, language);
        } else if (heading.textContent.includes('Property Information')) {
          heading.textContent = ContractTranslations.getTranslation('ui.property_info', {}, language);
        } else if (heading.textContent.includes('Cash Collateral Information')) {
          heading.textContent = ContractTranslations.getTranslation('ui.cash_collateral_info', {}, language);
        } else if (heading.textContent.includes('Signatures Required')) {
          heading.textContent = ContractTranslations.getTranslation('ui.signatures_required', {}, language);
        }
      });
      
      // Update buttons
      document.querySelectorAll('button[type="submit"]').forEach(button => {
        if (button.textContent.includes('Generate Contract')) {
          button.textContent = ContractTranslations.getTranslation('ui.generate_contract', {}, language);
        }
      });
      
      clearSignatureBtn.textContent = ContractTranslations.getTranslation('ui.clear', {}, language);
      saveSignatureBtn.textContent = ContractTranslations.getTranslation('ui.save_signature', {}, language);
      backToInfoBtn.textContent = ContractTranslations.getTranslation('ui.back', {}, language);
      finalizeContractBtn.textContent = ContractTranslations.getTranslation('ui.finalize_contract', {}, language);
      
      // Update main title
      document.querySelector('h1').textContent = ContractTranslations.getTranslation('contract.title', {}, language);
      
      // Update description
      document.querySelector('h1 + p').textContent = ContractTranslations.getTranslation('ui.contract_info_desc', {}, language);
      
      // Update step labels
      const stepLabels = document.querySelectorAll('.step-label');
      if (stepLabels.length >= 4) {
        stepLabels[0].textContent = ContractTranslations.getTranslation('ui.contract_info', {}, language);
        stepLabels[1].textContent = ContractTranslations.getTranslation('ui.review_sign', {}, language);
        stepLabels[2].textContent = ContractTranslations.getTranslation('ui.blockchain_deployment', {}, language);
        stepLabels[3].textContent = ContractTranslations.getTranslation('ui.verification', {}, language);
      }
      
      // Update card titles
      document.querySelectorAll('.card h2').forEach(title => {
        if (title.textContent.includes('Bond Contract Information')) {
          title.textContent = ContractTranslations.getTranslation('ui.contract_info', {}, language);
        } else if (title.textContent.includes('Review & Sign')) {
          title.textContent = ContractTranslations.getTranslation('ui.review_sign', {}, language);
        } else if (title.textContent.includes('Blockchain Deployment')) {
          title.textContent = ContractTranslations.getTranslation('ui.blockchain_deployment', {}, language);
        } else if (title.textContent.includes('Contract Successfully')) {
          title.textContent = ContractTranslations.getTranslation('ui.contract_success', {}, language);
        }
      });
      
      // Show a toast notification about language change
      const title = ContractTranslations.getTranslation('toast.welcome', {}, language);
      const message = ContractTranslations.getTranslation('toast.welcome_desc', {}, language);
      showToast(title, message);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Populate dropdowns
      populateFormDropdowns();
      
      // Initialize signature pad
      resizeCanvas();
      
      // Set default signature type
      signatureTypeSelect.value = 'defendant';
      
      // Initialize language selector if translations are available
      const languageSelector = document.getElementById('language-selector');
      if (languageSelector && typeof ContractTranslations !== 'undefined') {
        languageSelector.addEventListener('change', (e) => {
          changeContractLanguage(e.target.value);
        });
        
        // Set initial language
        const initialLanguage = languageSelector.value;
        if (initialLanguage) {
          changeContractLanguage(initialLanguage);
        }
      }
      
      // Show welcome toast with correct language
      setTimeout(() => {
        const currentLanguage = languageSelector?.value || 'en';
        if (typeof ContractTranslations !== 'undefined') {
          const title = ContractTranslations.getTranslation('toast.welcome', {}, currentLanguage);
          const message = ContractTranslations.getTranslation('toast.welcome_desc', {}, currentLanguage);
          showToast(title, message);
        } else {
          showToast('Welcome', 'Generate an Oklahoma bail bond contract secured on the blockchain.');
        }
      }, 500);
      
      // Initialize IPFS if available
      if (window.IPFSStorage && typeof window.IPFSStorage.initIPFS === 'function') {
        try {
          window.IPFSStorage.initIPFS()
            .then(() => {
              console.log('IPFS initialized successfully');
              showToast('Decentralized Storage', 'IPFS decentralized storage initialized for secure contracts', 'success');
              
              // Add IPFS badge to header
              const header = document.querySelector('header');
              if (header) {
                const ipfsBadge = document.createElement('div');
                ipfsBadge.className = 'ipfs-badge';
                ipfsBadge.innerHTML = '<i class="fas fa-database"></i> IPFS Enabled';
                ipfsBadge.style.position = 'absolute';
                ipfsBadge.style.top = '0.5rem';
                ipfsBadge.style.left = '0.5rem';
                ipfsBadge.style.fontSize = '0.75rem';
                ipfsBadge.style.backgroundColor = 'rgba(22, 163, 74, 0.1)';
                ipfsBadge.style.color = 'var(--success)';
                ipfsBadge.style.padding = '0.25rem 0.5rem';
                ipfsBadge.style.borderRadius = '9999px';
                header.style.position = 'relative';
                header.appendChild(ipfsBadge);
              }
            })
            .catch(error => {
              console.error('Failed to initialize IPFS:', error);
            });
        } catch (error) {
          console.error('Error initializing IPFS:', error);
        }
      }
    });
  </script>
  
  <!-- PWA Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          })
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>
  
  <!-- IPFS Integration Script -->
  <script src="./ipfs-storage.js"></script>
</body>
</html>
